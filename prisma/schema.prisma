// MyFO Database Schema
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  
  plans          Plan[]
  transactions   Transaction[]
  plannedItems   PlannedItem[]
  fafsaChecklist FafsaChecklist?
  incomeSources  IncomeSource[]
  emergencyFund  EmergencyFund?
}

model Plan {
  id                   String   @id @default(uuid())
  userId               String
  user                 User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Dates
  startDate            DateTime
  endDate              DateTime
  disbursementDate     DateTime
  
  // Starting balance
  startingBalance      Float
  
  // Funding (legacy - can be derived from IncomeSource)
  grants               Float    @default(0)
  loans                Float    @default(0)
  workStudyMonthly     Float    @default(0)
  otherIncomeMonthly   Float    @default(0)
  
  // Fixed costs (monthly) - stored as JSON
  fixedCostsJson       String   // { rent, utilities, subscriptions, transportation }
  
  // Variable budgets (weekly) - stored as JSON
  variableBudgetsJson  String   // { groceries, dining, entertainment, misc }
  
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
}

model Transaction {
  id              String   @id @default(uuid())
  userId          String
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  date            DateTime
  description     String
  amount          Float    // Positive = spending, negative = income (or handle consistently)
  category        String   // One of the CATEGORIES enum
  merchantGuess   String?
  source          String   @default("csv") // "csv" or "manual"
  
  createdAt       DateTime @default(now())
  
  @@index([userId, date])
}

model PlannedItem {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  name      String
  date      DateTime
  amount    Float
  category  String
  notes     String?
  
  createdAt DateTime @default(now())
  
  @@index([userId, date])
}

model FafsaChecklist {
  id              String   @id @default(uuid())
  userId          String   @unique
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  createFsaId     Boolean  @default(false)
  gatherTaxDocs   Boolean  @default(false)
  listSchools     Boolean  @default(false)
  submitFafsa     Boolean  @default(false)
  verification    Boolean  @default(false)
  reviewAward     Boolean  @default(false)
  acceptAid       Boolean  @default(false)
  markCalendar    Boolean  @default(false)
  
  updatedAt       DateTime @updatedAt
}

// NEW: Income Sources - track all money coming in
model IncomeSource {
  id           String   @id @default(uuid())
  userId       String
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  type         String   // "job" | "scholarship" | "grant" | "loan" | "family" | "work_study" | "other"
  name         String   // e.g., "Campus Library Job", "Pell Grant", "Subsidized Loan"
  amount       Float    // Total or periodic amount
  frequency    String   // "one_time" | "monthly" | "biweekly" | "weekly" | "semester"
  startDate    DateTime?
  endDate      DateTime?
  isLoan       Boolean  @default(false)
  interestRate Float?   // For loans only (as percentage, e.g., 4.5)
  notes        String?
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@index([userId, type])
}

// NEW: Emergency Fund - savings goal tracking
model EmergencyFund {
  id                  String   @id @default(uuid())
  userId              String   @unique
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  targetAmount        Float    @default(500)   // Goal amount
  currentAmount       Float    @default(0)     // Saved so far
  weeklyContribution  Float    @default(0)     // Auto-save per week
  
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
}
